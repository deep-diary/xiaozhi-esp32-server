# Immich äººè„¸è¯†åˆ« API è°ƒç”¨æµç¨‹å›¾

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¼€å§‹ï¼šè¾“å…¥ç…§ç‰‡                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ä¸Šä¼ ç…§ç‰‡åˆ° Immich                                    â”‚
â”‚  POST /api/asset/upload                                      â”‚
â”‚  - å‚æ•°: assetData (ç…§ç‰‡æ–‡ä»¶)                                 â”‚
â”‚  - è¿”å›: asset_id                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: ç­‰å¾… Immich å¤„ç†ç…§ç‰‡                                â”‚
â”‚  - è½®è¯¢ GET /api/asset/{asset_id}                           â”‚
â”‚  - æ£€æŸ¥ faces æˆ– people å­—æ®µæ˜¯å¦å·²ç”Ÿæˆ                       â”‚
â”‚  - ç­‰å¾…æ—¶é—´: 5ç§’ - å‡ åˆ†é’Ÿï¼ˆå–å†³äºç…§ç‰‡å¤§å°ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: è·å–èµ„äº§è¯¦æƒ…ï¼ˆåŒ…å«äººç‰©ä¿¡æ¯ï¼‰                        â”‚
â”‚  GET /api/asset/{asset_id}                                  â”‚
â”‚  - è¿”å›: people[] (äººç‰©åˆ—è¡¨)                                 â”‚
â”‚  - æ¯ä¸ª person åŒ…å«: id, name, thumbnailPath                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ¤æ–­ï¼šç…§ç‰‡ä¸­æ˜¯å¦æœ‰äººç‰©ï¼Ÿ                                      â”‚
â”‚  if people.length == 0                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚
     æ˜¯â”‚                               â”‚å¦
       â”‚                               â”‚
       â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç©ºç»“æœ    â”‚            â”‚ éå†æ¯ä¸ªäººç‰©                 â”‚
â”‚ "æœªæ£€æµ‹åˆ°äººç‰©"â”‚            â”‚ for person in people:       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Step 4: è·å–äººç‰©çš„ç…§ç‰‡               â”‚
                    â”‚  GET /api/person/{person_id}/assets   â”‚
                    â”‚  - å‚æ•°: size=10 (é™åˆ¶è¿”å›10å¼ )       â”‚
                    â”‚  - è¿”å›: è¯¥äººç‰©çš„ç…§ç‰‡åˆ—è¡¨              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  æ„å»ºè¿”å›ç»“æœ                          â”‚
                    â”‚  {                                    â”‚
                    â”‚    person_id: "...",                 â”‚
                    â”‚    person_name: "å¼ ä¸‰",               â”‚
                    â”‚    photos: [...] (10å¼ ç…§ç‰‡)           â”‚
                    â”‚  }                                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  è¿”å›æœ€ç»ˆç»“æœ                          â”‚
                    â”‚  {                                    â”‚
                    â”‚    asset_id: "...",                   â”‚
                    â”‚    people: [                          â”‚
                    â”‚      { person_name, photos },         â”‚
                    â”‚      { person_name, photos },         â”‚
                    â”‚      ...                              â”‚
                    â”‚    ]                                  â”‚
                    â”‚  }                                    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š æ•°æ®æµç¤ºä¾‹

### è¾“å…¥
```
ç…§ç‰‡æ–‡ä»¶: photo.jpg
```

### Step 1 è¾“å‡º
```json
{
  "id": "asset-123",
  "duplicate": false,
  "status": "SUCCESS"
}
```

### Step 2 è½®è¯¢è¿‡ç¨‹
```json
// ç¬¬1æ¬¡æŸ¥è¯¢ï¼ˆå¤„ç†ä¸­ï¼‰
{
  "id": "asset-123",
  "faces": null,
  "people": []
}

// ç¬¬3æ¬¡æŸ¥è¯¢ï¼ˆå¤„ç†å®Œæˆï¼‰
{
  "id": "asset-123",
  "faces": [
    {
      "id": "face-1",
      "personId": "person-1"
    },
    {
      "id": "face-2",
      "personId": "person-2"
    }
  ],
  "people": [
    {
      "id": "person-1",
      "name": "å¼ ä¸‰"
    },
    {
      "id": "person-2",
      "name": "æå››"
    }
  ]
}
```

### Step 3 è¾“å‡º
```json
{
  "id": "asset-123",
  "people": [
    {
      "id": "person-1",
      "name": "å¼ ä¸‰",
      "thumbnailPath": "/path/to/thumb1.jpg"
    },
    {
      "id": "person-2",
      "name": "æå››",
      "thumbnailPath": "/path/to/thumb2.jpg"
    }
  ]
}
```

### Step 4 è¾“å‡ºï¼ˆæ¯ä¸ªäººç‰©ï¼‰
```json
{
  "items": [
    {
      "id": "asset-1",
      "originalPath": "/path/to/photo1.jpg",
      "thumbnailPath": "/path/to/thumb1.jpg"
    },
    {
      "id": "asset-2",
      "originalPath": "/path/to/photo2.jpg",
      "thumbnailPath": "/path/to/thumb2.jpg"
    }
    // ... æœ€å¤š10å¼ 
  ],
  "total": 15,
  "page": 1,
  "size": 10
}
```

### æœ€ç»ˆè¾“å‡º
```json
{
  "asset_id": "asset-123",
  "people": [
    {
      "person_id": "person-1",
      "person_name": "å¼ ä¸‰",
      "photos": [
        {
          "id": "asset-1",
          "originalPath": "/path/to/photo1.jpg",
          "thumbnailPath": "/path/to/thumb1.jpg"
        },
        // ... 10å¼ ç…§ç‰‡
      ]
    },
    {
      "person_id": "person-2",
      "person_name": "æå››",
      "photos": [
        // ... 10å¼ ç…§ç‰‡
      ]
    }
  ]
}
```

## ğŸ”‘ å…³é”® API ç«¯ç‚¹æ€»ç»“

| æ­¥éª¤ | æ–¹æ³• | ç«¯ç‚¹ | è¯´æ˜ |
|------|------|------|------|
| 1 | POST | `/api/asset/upload` | ä¸Šä¼ ç…§ç‰‡ |
| 2 | GET | `/api/asset/{id}` | è½®è¯¢æ£€æŸ¥å¤„ç†çŠ¶æ€ |
| 3 | GET | `/api/asset/{id}` | è·å–èµ„äº§è¯¦æƒ…ï¼ˆäººç‰©ä¿¡æ¯ï¼‰ |
| 4 | GET | `/api/person/{id}/assets` | è·å–äººç‰©çš„ç…§ç‰‡ |

## â±ï¸ æ—¶é—´çº¿ä¼°ç®—

```
æ—¶é—´è½´:
0s  â”€â”€â–º ä¸Šä¼ ç…§ç‰‡
     â”‚
5s  â”€â”€â–º å¼€å§‹å¤„ç†ï¼ˆäººè„¸æ£€æµ‹ï¼‰
     â”‚
10s â”€â”€â–º ç‰¹å¾æå–å®Œæˆ
     â”‚
15s â”€â”€â–º äººç‰©åŒ¹é…å®Œæˆ
     â”‚
20s â”€â”€â–º è¿”å›ç»“æœ
```

**æ³¨æ„**: å®é™…æ—¶é—´å–å†³äºï¼š
- ç…§ç‰‡å¤§å°
- æœåŠ¡å™¨æ€§èƒ½
- äººè„¸æ•°é‡
- ç½‘ç»œé€Ÿåº¦

## ğŸ¯ ä¼˜åŒ–å»ºè®®

### 1. å¼‚æ­¥å¤„ç†
- ä¸Šä¼ åç«‹å³è¿”å› asset_id
- å®¢æˆ·ç«¯è½®è¯¢æˆ–ä½¿ç”¨ WebSocket æ¥æ”¶å¤„ç†å®Œæˆé€šçŸ¥

### 2. æ‰¹é‡å¤„ç†
- ä¸€æ¬¡ä¸Šä¼ å¤šå¼ ç…§ç‰‡
- å¹¶è¡Œå¤„ç†å¤šä¸ªäººç‰©æŸ¥è¯¢

### 3. ç¼“å­˜ç­–ç•¥
- ç¼“å­˜å·²è¯†åˆ«çš„äººç‰©ä¿¡æ¯
- é¿å…é‡å¤æŸ¥è¯¢ç›¸åŒäººç‰©

### 4. é”™è¯¯é‡è¯•
- ç½‘ç»œé”™è¯¯è‡ªåŠ¨é‡è¯•
- å¤„ç†è¶…æ—¶å¢åŠ é‡è¯•æ¬¡æ•°

