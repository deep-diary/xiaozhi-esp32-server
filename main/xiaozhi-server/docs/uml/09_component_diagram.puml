@startuml 系统组件关系图
!theme plain

package "客户端层" {
    [ESP32设备]
}

package "网络层" {
    [WebSocket服务器]
    [HTTP服务器]
}

package "应用层" {
    [连接管理器]
    [消息路由器]
}

package "核心服务层" {
    package "语音处理" {
        [VAD服务]
        [ASR服务]
        [TTS服务]
    }
    
    package "AI服务" {
        [LLM服务]
        [意图识别服务]
        [记忆服务]
    }
}

package "工具层" {
    [统一工具处理器]
    [工具管理器]
    [工具执行器]
}

package "插件层" {
    [系统插件]
    [自定义插件]
    [IoT插件]
    [MCP插件]
}

package "数据层" {
    [对话历史]
    [记忆存储]
    [配置管理]
    [缓存管理]
}

[ESP32设备] --> [WebSocket服务器]
[WebSocket服务器] --> [连接管理器]
[连接管理器] --> [消息路由器]

[消息路由器] --> [VAD服务]
[消息路由器] --> [ASR服务]
[消息路由器] --> [LLM服务]
[消息路由器] --> [意图识别服务]
[消息路由器] --> [TTS服务]

[LLM服务] --> [统一工具处理器]
[意图识别服务] --> [统一工具处理器]
[统一工具处理器] --> [工具管理器]
[工具管理器] --> [工具执行器]

[工具执行器] --> [系统插件]
[工具执行器] --> [自定义插件]
[工具执行器] --> [IoT插件]
[工具执行器] --> [MCP插件]

[连接管理器] --> [对话历史]
[记忆服务] --> [记忆存储]
[连接管理器] --> [配置管理]
[统一工具处理器] --> [缓存管理]

@enduml

